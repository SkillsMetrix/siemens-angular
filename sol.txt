
import { Actions, createEffect, ofType } from '@ngrx/effects'
import { DataService } from 'src/app/Service/data.service'
import { addMovies, addMoviesSuccess, getMovies, getMoviesSuccess } from '../Actions/movie.action'
import { catchError, concatMap, exhaustMap, map } from 'rxjs/operators'
import { EmptyError } from 'rxjs'
import { Injectable } from '@angular/core'
@Injectable()
export class MovieEffect {
    loadMovie$ = createEffect(() =>
        this.action$.pipe(
            ofType(getMovies),
            exhaustMap(() =>
                this.ds.getMovies().pipe(
                    map((movies) => getMoviesSuccess(movies)),

                )
            )
        )
    )
    addMovie$ = createEffect(() =>
        this.action$.pipe(
            ofType(addMovies),
            concatMap(({ movie }) =>
                this.ds.addMovies(movie).pipe(
                    map((newMovie) => addMoviesSuccess(newMovie))
                )
            )

        ))
    constructor(private action$: Actions, private ds: DataService) { }
}
